@using Signum.Utilities.ExpressionTrees
@using Signum.Engine.Cache
@using Signum.Web.Cache
@model List<CachedTableBase>
<h2>@ViewData[ViewDataKeys.Title]</h2>
<div>
    <a href="@Url.Action((CacheController pc) => pc.Disable())" class="sf-button" 
        style="@(!CacheLogic.GloballyDisabled ? "" : "display:none");color:red" id="sfCacheDisable">Disable </a>
    <a href="@Url.Action((CacheController pc) => pc.Enable())" class="sf-button"  
        style="@(CacheLogic.GloballyDisabled ? "" : "display:none")" id="sfCacheEnable">Enable </a>
    <a href="@Url.Action((CacheController pc) => pc.Clean())" class="sf-button" id="sfCacheClear">Clean </a>
</div>
<table class="sf-search-results sf-stats-table">
    <thead>
        <tr>
            <th>Table
            </th>
            <th>Type
            </th>
            <th>Count
            </th>
            <th>Hits
            </th>
            <th>Invalidations
            </th>
            <th>Loads
            </th>
            <th>LoadTime
            </th>
        </tr>
    </thead>
    <tbody>

        @helper ShowTree(CachedTableBase table, string prefix)
{
            <tr>
                <td>@(prefix + table.Table.Name.Name)
                </td>
                <td>@table.Type.TypeName()
                </td>
                <td>@(table.Count.TryToString() ?? "-- not loaded --")
                </td>
                <td>@table.Hits.DefaultToNull()
                </td>
                <td>@table.Invalidations.DefaultToNull()
                </td>
                <td>@table.Loads.DefaultToNull()
                </td>
                <td>@table.SumLoadTime.NiceToString()
                </td>
            </tr>
            
    if (table.SubTables != null)
    {
        foreach (var st in table.SubTables)
        {
            @ShowTree(st, prefix + " -> ")
        }
    }
        }

        @foreach (var table in Model)
        {
            @ShowTree(table, null)
        }
    </tbody>
</table>
<script>
    $(function () {
        @(new JsFunction(CacheClient.Model, "init"));
    }); 
</script>
